<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Rookie.App.ViewModels"
        x:Class="Rookie.App.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Width="1200" Height="760"
        Title="Rookie (macOS Device Manager)">

  <Window.DataContext>
    <vm:MainWindowViewModel/>
  </Window.DataContext>

  <Grid RowDefinitions="Auto,*,Auto,Auto" Margin="12" RowSpacing="10" ColumnSpacing="10">

    <!-- Top bar -->
    <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto,Auto" ColumnSpacing="10">
      <TextBlock Text="Device:" VerticalAlignment="Center"/>
      <ComboBox Grid.Column="1"
                ItemsSource="{Binding Devices}"
                SelectedItem="{Binding SelectedDevice}"
                MinWidth="350"/>
      <Button Grid.Column="2" Content="Refresh Devices" Click="RefreshDevices_Click"/>
      <Button Grid.Column="3" Content="Load Packages" Click="LoadPackages_Click"/>
      <Button Grid.Column="4" Content="Install APKâ€¦" Click="InstallApk_Click"/>
      <Button Grid.Column="5" Content="Reload Server" Click="ReloadServer_Click"/>
    </Grid>

    <!-- Middle: 3 columns -->
    <Grid Grid.Row="1" ColumnDefinitions="*,*,Auto" ColumnSpacing="10">

      <!-- Left: Server Library -->
      <Border BorderThickness="1" Padding="10">
        <DockPanel>
          <StackPanel DockPanel.Dock="Top" Margin="0,0,0,8">
            <TextBlock Text="{Binding ServerName}" FontSize="16"/>
            <TextBlock Text="{Binding ServerUrl}" Opacity="0.7" FontSize="11"/>
          </StackPanel>

          <ListBox ItemsSource="{Binding ServerApps}"
                   SelectedItem="{Binding SelectedServerApp}">
            <ListBox.ItemTemplate>
              <DataTemplate>
                <StackPanel>
                  <TextBlock Text="{Binding Name}"/>
                  <TextBlock Text="{Binding Id}" Opacity="0.65" FontSize="11"/>
                </StackPanel>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>
        </DockPanel>
      </Border>

      <!-- Middle: Installed packages -->
      <Border Grid.Column="1" BorderThickness="1" Padding="10">
        <Grid RowDefinitions="Auto,*">
          <TextBlock Text="Installed Packages" FontSize="16" Margin="0,0,0,6"/>
          <TextBox Grid.Row="0"
                   Watermark="Filter packages..."
                   Text="{Binding PackageFilter}"
                   Margin="0,26,0,8"/>
          <ListBox Grid.Row="1"
                   ItemsSource="{Binding Packages}"
                   SelectedItem="{Binding SelectedPackage}"/>
        </Grid>
      </Border>

      <!-- Right: Actions -->
      <Border Grid.Column="2" BorderThickness="1" Padding="10" MinWidth="260">
        <StackPanel Spacing="10">
          <TextBlock Text="Actions" FontSize="16"/>
          <Button Content="Download + Install (Selected Server App)" Click="DownloadInstall_Click"/>
          <Button Content="Uninstall Selected Package" Click="UninstallSelected_Click"/>
          <TextBlock Text="{Binding Status}" TextWrapping="Wrap" Margin="0,10,0,0"/>
        </StackPanel>
      </Border>

    </Grid>

    <!-- Progress -->
    <ProgressBar Grid.Row="2" Minimum="0" Maximum="1" Value="{Binding Progress}"/>

    <!-- Log -->
    <Border Grid.Row="3" BorderThickness="1" Padding="10">
      <DockPanel>
        <TextBlock DockPanel.Dock="Top" Text="Log" FontSize="16" Margin="0,0,0,8"/>
        <ListBox ItemsSource="{Binding Log}" Height="200"/>
      </DockPanel>
    </Border>

  </Grid>
</Window>
